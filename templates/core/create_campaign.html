{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link href="{% static 'css/create_campaign.css' %}" rel="stylesheet">
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const emailFields = ['email_1', 'email_2', 'email_3'];
            const emailTemplateSelect = document.querySelector('select[name="email_template"]');
            const totalCostDisplay = document.getElementById('totalCost');
            const emailTemplates = {{ email_templates|safe }};  // Pass in email_templates data as a JSON object

            // Function to calculate the total cost
            function calculateTotalCost() {
                let filledEmails = 0;

                // Count how many email fields are filled
                emailFields.forEach(function (field) {
                    const emailValue = document.querySelector(`input[name="${field}"]`).value;
                    if (emailValue.trim() !== '') {
                        filledEmails++;
                    }
                });

                // Get the selected template's XP cost
                const selectedTemplateId = emailTemplateSelect.value;
                const selectedTemplate = emailTemplates.find(template => template.id == selectedTemplateId);
                const xpCost = selectedTemplate ? selectedTemplate.xp_cost : 0;

                // Calculate the total cost (emails * xpCost)
                const totalCost = filledEmails * xpCost;

                // Update the total cost display
                totalCostDisplay.textContent = totalCost.toFixed(2);  // Display it as XP
            }

            // Attach event listeners to email fields and email template select
            emailFields.forEach(function (field) {
                document.querySelector(`input[name="${field}"]`).addEventListener('input', calculateTotalCost);
            });
            emailTemplateSelect.addEventListener('change', calculateTotalCost);
        });
    </script>
</head>
<body class="bg-gray-50">
    <div class="min-h-screen p-6">
        <div class="max-w-4xl mx-auto bg-white rounded-lg shadow-lg p-8">
            <h1 class="text-3xl font-bold text-gray-800 mb-8">Create a Multi Campaign</h1>
            
            <!-- XP Balance Display -->
            <div class="bg-blue-50 p-4 rounded-lg mb-8 flex justify-between items-center">
                <div>
                    <span class="text-blue-700 font-semibold">Your XP Balance:</span>
                    <span class="text-blue-900 text-xl ml-2">{{ user_profile.xp_balance }} XP</span>
                </div>
                <div>
                    <span class="text-blue-700 font-semibold">Total Mailing Fee:</span>
                    <span class="text-blue-900 text-xl ml-2" id="totalCost">0 XP</span>
                </div>
            </div>

            <!-- Multi Campaign Form -->
            <form method="POST" class="space-y-6">
                {% csrf_token %}

                {{ form.non_field_errors }}

                <!-- Email 1 -->
                <div class="form-group">
                    <label for="email_1">Recipient Email 1</label>
                    {{ form.email_1 }}
                </div>

                <!-- Email 2 -->
                <div class="form-group">
                    <label for="email_2">Recipient Email 2</label>
                    {{ form.email_2 }}
                </div>

                <!-- Email 3 -->
                <div class="form-group">
                    <label for="email_3">Recipient Email 3</label>
                    {{ form.email_3 }}
                </div>

                <!-- Email Template -->
                <div class="form-group">
                    <label for="email_template">Email Template</label>
                    {{ form.email_template }}
                </div>

                <!-- Cryptocurrency -->
                <div class="form-group">
                    <label for="cryptocurrency">Cryptocurrency</label>
                    {{ form.cryptocurrency }}
                </div>

                <!-- Quantity -->
                <div class="form-group">
                    <label for="quantity">Quantity</label>
                    {{ form.quantity }}
                </div>

                <!-- Minimum Balance -->
                <div class="form-group">
                    <label for="min_balance">Minimum Balance</label>
                    {{ form.min_balance }}
                </div>

                <!-- Submit Button -->
                <div class="form-group">
                    <button type="submit" class="w-full bg-blue-600 text-white py-3 px-6 rounded-lg font-medium hover:bg-blue-700 transition-colors">
                        Create Multi Campaign
                    </button>
                </div>
            </form>
        </div>
    </div>
</body>
</html>
